---
title: "assignment_5_jj_ab"
author: "Jessica Jagdeo and Alex Brown"
date: "November 28, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}

library(tidyverse)
library(stargazer)

faculty_salary <- read_csv("faculty_salary_data.csv")

grad_enrollment <- read_csv("grad_enrollment_2.csv")

med_salary_doctoral <- read_csv("median_salary_doctoral.csv")

phds <- read_csv("phds_by_field.csv")
```

###1). Male and female graduate enrollment (1967 - 2015). Compare trends in total graduate enrollment for males and females (including full-time/part-time and private/public universities) in the United States from 1967 - 2015. Describe your results statistically, graphically and in text.

```{r, echo=FALSE}
# Run a single regression model on graduate male graduate students from 1967-2015

male_grad_lm <- lm(grad_enrollment$total_males ~ grad_enrollment$year)

male_grad_lm

# Graph total male enrollment in US grad schools

grad_male_lmgraph <- ggplot(grad_enrollment, aes(x = year, y = total_males)) +
geom_point() +
geom_smooth(method = lm, se = TRUE, size = 0.5, color = "dodgerblue") +
theme_bw() +
scale_x_continuous(expand = c(0,0), limits = c(1967, 2015)) +
labs(x = "Year", y = "Total Male Enrollment in U.S. Grad Schools")

grad_male_lmgraph

# # Run a single regression model on graduate female graduate students from 1967-2015.

female_grad_lm <- lm(grad_enrollment$total_females ~ grad_enrollment$year) 

female_grad_lm

# Graph total female enrollment in US grad schools

grad_female_lmgraph <- ggplot(grad_enrollment, aes(x = year, y = total_females)) +
geom_point() +
geom_smooth(method = lm, se = TRUE, size = 0.5, color = "dodgerblue") +
theme_bw() +
scale_x_continuous(expand = c(0,0), limits = c(1967, 2015)) +
labs(x = "Year", y = "Total Female Enrollment in U.S. Grad Schools")

grad_female_lmgraph
```

###2.) Shifts in female PhD recipients by field (1985, 2000, and 2015). Describe if and how there was a shift in PhDs awarded to females in four fields (Physical and Earth Sciences, Engineering, Education, and Humanities & Arts) in 1985, 2000, and 2015. Describe your results statistically, in a graph or table, and in text. Note: There are several ways that you can interpret this question. You are invited to decide which you think is/are most interesting. Just be really clear about what you are asking/answering in your report.

```{r}

female_phd <- phds %>% 
  select("field_of_study_sex","1985","2000","2015")

phd_female_lm <- lm(field_of_study_sex ~ 1985 + 2000 + 2015, data = female_phd)

```





###3. Compare median salaries for male and female doctorate recipients in 2015. Answer these two questions:Does median salary differ significantly between male and female starting postdoc positions? Does median salary differ significantly between male and female PhD recipients in non-postdoc employment positions?

```{r}

# Create histograms to see if median salary data for employed and postdoc positions are normal

employmale_hist <- ggplot(med_salary_doctoral, aes(x = employment_male)) +
  geom_histogram()

employmale_hist

employfemale_hist <- ggplot(med_salary_doctoral, aes(x = employment_female)) +
  geom_histogram()

employfemale_hist

postdocmale_hist <- ggplot(med_salary_doctoral, aes(x = postdoc_male)) +
  geom_histogram() 

postdocmale_hist

postdocfemale_hist <- ggplot(med_salary_doctoral, aes(x = postdoc_female)) +
  geom_histogram() 

postdocfemale_hist

# Data is roughly normally distributed for employment median salary, but not normal for postdoc median salaries. We are going to use a non-parametric test since we want to compare medians, so we need to use a rank-based test. Tht test should be paired so that we are comparing males and females within their own fields. 

```

```{r}

# Run a Wilcoxon signed-rank test (paired) for males and females within their specific fields who are employed

# Null: The ranks are equal

# Alternative: The ranks are NOT equal

wsr_employ <- wilcox.test(med_salary_doctoral$employment_male, med_salary_doctoral$employment_female, paired = TRUE)

wsr_employ

# p value = 0.0026, less than 0.05, indicating that we reject the null hypothesis. The ranks are NOT equal. 

# Median salary differs significantly between male and female PhD recipients in non-postdoc employment positions based on 2005 median salary data.
```

```{r}

# Run a Wilcoxon signed-rank test (paired) for males and females within their specific fields who are postdocs

# Null: The ranks are equal

# Alternative: The ranks are NOT equal

wsr_postdoc <- wilcox.test(med_salary_doctoral$postdoc_male, med_salary_doctoral$postdoc_female, paired = TRUE)

wsr_postdoc

# p value = 0.888, which is greater than 0.05. Thus, we retain the null hypothesis. The ranks are equal.

# Median salary DOES NOT differ significantly between male and female PhD recipients starting postdoc positions based on 2005 median salary data. 

```

###4. Explore relationships between variables in the ‘Faculty salary data (2008 - 2009 survey)’ dataset. Develop a model describing faculty salary based on data for faculty sex, rank, years in current position, field, and number of years since doctoral degree was earned. You should make decisions regarding which variables should remain in your final model. Describe the results qualitatively and quantitatively (i.e., don’t just report the statistical results of the model – make sure you describe interesting findings in text). You can also discuss any concerns that you have with the model(s) you present, if any.

```{r}

# First, look at the data graphically to determine if a linear relationship exists between faculty salary

salary_scatter <- ggplot(faculty_salary, aes(x = years_since_phd, y = salary)) +
  geom_point(aes(color = rank)) +
  facet_wrap(~ sex)

salary_scatter

# There seems to be a linear relationship between faculty salary and sex, ranks, and number of years since doctoral degree was earned

```

```{r}

# Create a mutivariate linear regression model for faculty salary

faculty_salary_lm <- lm(salary ~ sex + rank + years_since_phd + years_faculty_service + discipline, data = faculty_salary)

summary(faculty_salary_lm)

# Reference levels are females, associate professors, and discipline A. 

# salary = 4783.5(sexmale) - 12907.6(rankAsstProf) + 32158.4(rankProf) + 535.1(years_since_phds) - 489.5(years_faculty_service) + 14417.6(disciplineB)

# If all other variables are the same, then male graduates with PhDs make $4,783.5 more than female graduates with PhDs.

# If all other variables are the same, then professors make $32,158.4 more than associate professors. 

# Adjusted R2 value is 0.45

```

```{r}

# Check out model diagnostics

plot(faculty_salary_lm)

# Residuals are mostly linear, according to QQ plot, until you get to larger values. 

# Residuals vs. fitted shows scatter, but slight concentration around 0

```

```{r, results = 'asis'}

# Prepare a residuals table

stargazer(faculty_salary_lm, type = "html")

```

